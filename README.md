# auto-watchbill
A tool to assist in fast and fair shift scheduling. Formulates schedule requirements as a Constraint Satisfaction Problem for use with the Minion solver. 

# Backstory
As a junior officer on USS Springfield, one of my responsibilities was to manage shift scheduling for the officers while the ship was in port. We operated on 24-hour shifts, with two officers on-duty each day to supervise the day's maintenance projects and routine upkeep. Even in port, keeping a nuclear submarine safe requires constant viligance by the crew - an engineering tank could still overflow, or air could leak out of the ballast tanks causing the boat to sink too far into the water.  With about 10 qualified officers on board, and with limited in-port time to enjoy with friends and family, the exact distribution of duty days was the subject of intense jockeying once a month when a new watchbill was drafted. The dreaded Saturday duty day meant that you would need to be in bed early on Friday, report to the ship at 0530 on Saturday to prepare for the day's operations, spend the day working on the ship, wake up at midnight to check for safe conditions, and leave exhausted on Sunday morning at 0700. Worse, there was always more work to be done than time available, and there was never enough slack in the schedule to "pay back" weekend duty days with an extra day off.

Before I got involved with the process, the Senior Watch Officer responsible for managing the officers would generally keep a running tally of schedule constraints - required Navy schools, what little vacation time could be afforded, and an array of proficiency and qualification requirements. At times, it could be difficult to draft a schedule at all! Under the surface, there were a lot of "ideal" feautures the watchbill writer would try to promote - say, making sure an officer didn't have to stand duty on the weekend too often, or keeping the schedule spaced out to allow a breather between duty days. Frequently, the first draft of a watchbill, produced with hours of experimentation in an Excel spreadsheet, would do pretty well at respecting these features. But new problems inevitably arose, and instead of going back to the drawing board to refactor and reoptimize the proposed watchbill, the Senior Watch Officer would make the smallest possible number of changes to the inital proposal. This would often negate all the optimization for the "ideal" features and could be a huge morale sink.

I realized that some part of this process could be automated or optimized and set out to investigate the best way to formulate it as a math problem. I thought at first that the way to go was to try out some binary optimization techniques. Each officer's day could be expressed as a 1 ("on-duty") or a 0 ("off-duty"), and a solver could find the "best" watchbill possible given the schedule constraints. It turned out to be very difficult to encode some rules effectively - the concept of avoiding adjacent on-duty days introduced some nonlinearity to the problem and made it too complicated for most of the open-source solvers I could find. At some point, I realized that I was really looking at a constraint satisfaction problem! I quickly discovered <a href="https://constraintmodelling.org/minion/">Minion</a> - and started experimenting.

All I had to do to "optimize" the watchbill was set up groups of constraints and see if the solver could find a solution. Some constraints were ironclad, like those that the Senior Watch Officer would plan around. Others were my way of "optimizing" the schedule - an officer could only be assigned a certain number of days per month, or a certain number of weekend days. When there were enough officers to allow some flexibility in the schedule, I could add in new constraints, like avoiding three duty days in the same week, or tighten down the old ones. If the solver couldn't find a solution, I knew I had to relax some of the constraints. The best part was the quick feedback; if a problem came up and the watchbill had to be rewritten, we could have a new watchbill in minutes rather than hours.

I didn't have access to many coding tools on the Navy computers we used at work, so I used Excel to "write" up Minion input files and interpret the output. Now that I'm off the ship and have some extra mental bandwidth, it occurs to me that across dozens of Navy ships, there must be a lot of time spent on writing watchbills. I'm uploading my "original" work in the hope that it could be developed into a more general tool that could help save the watchbill writer time, and provide a better result for everyone!
